@model IdentitySample.Models.HumDistributionPlan

@{
    ViewBag.Title = "План распределения гум. помощи";
}

<h2>Просмотр</h2>

<div>
    <h4>План распределения гум. помощи</h4>
    <hr />
    <dl class="dl-horizontal">
        <dt>
            @Html.DisplayNameFor(model => model.Company.Name)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Company.Name)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.Date)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.Date)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.CurrencyISOCode)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.CurrencyISOCode)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.CurrencyRate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.CurrencyRate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.CurrencyRateDate)
        </dt>

        <dd>
            @Html.DisplayFor(model => model.CurrencyRateDate)
        </dd>

        <dt>
            @Html.DisplayNameFor(model => model.State.Name)
        </dt>

        <dd>
            @if (Model.State == null)
            {
                <div class="alert alert-warning">@Html.ActionLink("Отправить в министерство", "SetState", new { reportId = Model.Id, code = 1 }, new { @class = "btn btn-info" })</div>
            }
            else if (Model.State.Code == 1)
            {
                <div class="alert alert-info">@Html.DisplayFor(model => model.State.Name) @*| @Html.ActionLink("Принять", "SetState", new { reportId = Model.Id, code = 2 }, new { @class = "btn btn-success" }) | @Html.ActionLink("Возвратить", "SetState", new { reportId = Model.Id, code = 3 }, new { @class = "btn btn-danger" })*@</div>
            }
            else if (Model.State.Code == 2)
            {
                <div class="alert alert-success">@Html.DisplayFor(model => model.State.Name) (@Html.DisplayNameFor(model => model.CertificateNo) @Html.DisplayFor(model => model.CertificateNo), @Html.DisplayNameFor(model => model.CertificateDate) @Html.DisplayFor(model => model.CertificateDate)) @*| @Html.ActionLink("Возвратить", "SetState", new { reportId = Model.Id, code = 3 }, new { @class = "btn btn-danger" })*@</div>
            }
            else if (Model.State.Code == 3)
            {
                <div class="alert alert-danger">@Html.DisplayFor(model => model.State.Name) @Html.ActionLink("Отправить в министерство", "SetState", new { reportId = Model.Id, code = 1 }, new { @class = "btn btn-info" })</div>
            }
        </dd>
    </dl>
    @*@Html.ActionLink("Ввод распределения", "Create", "HumDistributionPlanItems", new { HumDistributionPlanId = Model.Id }, new { @class = "btn btn-primary" })*@
    @Html.ActionLink("Скачать Excel", "GetFile", new { PlanId = Model.Id }, new { @class = "btn btn-info" })
    <table class="table table-striped table-bordered table-hover table-condensed" id="HumDistributionPlan">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().Consumer.Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().Area.Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().Address)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().Product.Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().UnitType.Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().Amount)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().Sum)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Items.First().ConvertedSum)
                    @if (Model.CurrencyRate.HasValue && Model.CurrencyRateDate.HasValue)
                    {
                        <text>(по курсу <i>@(Math.Round(Model.CurrencyRate.Value, 2))</i> от <i>@(Model.CurrencyRateDate.Value.ToShortDateString())</i>)</text>
                    }
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Items)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.Consumer.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Area.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Address)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Product.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.UnitType.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Amount)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Sum)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.ConvertedSum)
                    </td>
                </tr>
            }
            <tr style="font-weight:bold;">
                <td colspan="5" align="right">
                    Итого:
                </td>
                <td>
                    @Model.Items.Sum(x => x.Amount)
                </td>
                <td>
                    @Model.Items.Sum(x => x.Sum)
                </td>
                <td>
                    @(Math.Round(Model.Items.Sum(x => x.ConvertedSum) ?? 0, 2))
                </td>
            </tr>
        </tbody>
    </table>
    
    @if (Model.Reports.Count > 0)
    {
        @Html.ActionLink("Создать отчет", "Create", "Reports", new { HumDistributionPlanId = Model.Id }, new { @class = "btn btn-primary" })
        Html.RenderAction("ReportListPartial", "Reports", new { planId = Model.Id });
    }
</div>
<p>
    <a href="javascript://" onclick="window.history.back()">Назад</a>
</p>
@section scripts{
<script type="text/javascript">
    
</script>
    }